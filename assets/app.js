angular.module("app",["ngRoute"]),angular.module("app").controller("ApplicationCtrl",["$scope",function(t){t.$on("login",function(o,n){console.log(n),t.currentUser=n})}]),angular.module("app").controller("LoginCtrl",["$scope","UserSvc",function(t,o){t.login=function(n,e){o.login(n,e).then(function(o){t.$emit("login",o.data)})}}]),angular.module("app").controller("PostsCtrl",["$scope","PostService",function(t,o){t.addPost=function(){t.postBody&&o.create({username:"dickeyxxx",body:t.postBody}).then(function(o){t.postBody=null})},o.fetch().then(function(o){t.posts=o.data}),t.$on("ws:new_post",function(o,n){t.$apply(function(){t.posts.unshift(n)})})}]),angular.module("app").service("PostService",["$http",function(t){this.fetch=function(){return t.get("/api/posts")},this.create=function(o){return t.post("/api/posts",o)}}]),angular.module("app").config(["$routeProvider",function(t){t.when("/",{controller:"PostsCtrl",templateUrl:"posts.html"}).when("/register",{controller:"RegisterCtrl",templateUrl:"register.html"}).when("/login",{controller:"LoginCtrl",templateUrl:"login.html"})}]),angular.module("app").service("UserSvc",["$http",function(t){var o=this;o.getUser=function(){return t.get("/api/users",{headers:{"X-Auth":this.token}})},o.login=function(n,e){return t.post("/api/sessions",{username:n,password:e}).then(function(n){return o.token=n.data,t.defaults.headers.common["X-Auth"]=n.data,o.getUser()})}}]),angular.module("app").run(["$rootScope","$timeout",function(t,o){!function n(){var e=new WebSocket("ws://localhost:3000");e.onclose=function(t){console.log("Websocket closed.Reconnecting..."),o(n,1e4)},e.onmessage=function(o){console.log(o);var n=JSON.parse(o.data);t.$broadcast("ws:"+n.topic,n.data)}}()}]);